<?xml version="1.0" encoding="UTF-8"?>
<ui:composition 
  xmlns="http://www.w3.org/1999/xhtml" 
  xmlns:ui="http://java.sun.com/jsf/facelets" 
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html" 
  template="/WEB-INF/templates/forum.xhtml">

  <ui:define name="pageTitle">Forum</ui:define>
  <ui:define name="head">
    <!-- jQuery -->

    <script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.2.js"></script>
    
    <!-- CKEditor -->
    
    <script type="text/javascript" charset="utf8" src="http://cdnjs.cloudflare.com/ajax/libs/ckeditor/4.2/ckeditor.js"></script>
    
    <!-- View Scripts -->

    <h:outputScript name="scripts/gui/forum/ckconfig.js"></h:outputScript>
    <h:outputScript name="scripts/gui/forum/forum.js"></h:outputScript>
    
  </ui:define>
  <ui:define name="content">
    <h:form>
      <h:panelGroup layout="block" id="forum" styleClass="forum">
        <h3>
          <span class="forum-nav-item"><h:outputLink value="#{request.contextPath}/forum/">Forum</h:outputLink></span>
          <span class="forum-nav-separator"/>
          <span class="forum-nav-item">#{forumBackingBean.forum.name}</span>
        </h3>

        <div class="forum-container">
          <div class="forum-topics">
            <ui:repeat var="topic" value="#{forumBackingBean.topics}">
              <div class="forum-topic">
                <div class="forum-topic-subject">
                  <h:outputLink value="#{forumBackingBean.forum.urlName}/#{topic.urlName}">#{topic.subject}</h:outputLink>
                  <div class="forum-topic-message-count-container">
                    <span>Total Messages: </span>
                    <span class="forum-topic-message-count">#{forumBackingBean.getTopicPostCount(topic)}</span>
                  </div>
                  <div class="forum-topic-last-message-container">
                    <span class="">Last Message: </span>
                    <span class="forum-topic-last-message">
                      <h:outputText value="#{forumBackingBean.getLastMessageDate(topic)}">
                        <f:convertDateTime/> 
                      </h:outputText></span>
                  </div>                
                </div>
                
                <div class="forum-topic-author">
                  <span>Started by #{topic.author.fullName}</span>
                </div>
                <div class="forum-topic-created">
                  <span> at <h:outputText value="#{topic.created}">
                    <f:convertDateTime/> 
                  </h:outputText></span>
                </div>
              </div>
            </ui:repeat>
          </div>
        </div>   
        
        <div class="forum-new-topic-container">
          <div class="forum-new-topic-editor-container" style="display: none">
            <div>
              <h:outputLabel value="Subject" />
            </div>
            <div>
              <h:inputText required="required" class="forum-new-topic-subject" value="#{forumBackingBean.newTopicSubject}" />
            </div>
            <div>
              <h:outputLabel value="Contents" />
            </div>
            <div>
              <h:inputTextarea class="forum-topic-contents-editor" value="#{forumBackingBean.newTopicContents}" />
            </div>
            <div>
              <h:commandButton  class="forum-new-topic-button" value="New Topic" action="#{forumBackingBean.newTopic}" />
            </div>
          </div>
          
          <a href="javascript:void(null)" class="forum-new-topic-link">New Topic</a>
        </div>       

      </h:panelGroup>
    </h:form>    
  </ui:define>

</ui:composition>
