<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    template="/WEB-INF/templates/root.xhtml">
    
    <ui:define name="pageTitle">
      #{locales['root.editProfile.pageTitle']}
    </ui:define>
    
    <ui:define name="content">
      <h:outputScript name="scripts/jshash/md5-min.js" target="head"/>
      <h:outputScript name="scripts/gui/common/imageselectdialog.js" target="head"/>
      <h:outputScript name="scripts/gui/editprofile.js" target="head"/>
      <h:outputScript target="head">
        var viewController = new EditProfileViewController();
    
        Event.observe(document, "dom:loaded", function (event) {
          viewController.setup();
        });
        
        Event.observe(window, "beforeunload", function (event) {
          viewController.destroy();
        });
      </h:outputScript>
      
      <div id="editProfile">
        <h2>
          #{locales['root.editProfile.pageTitle']}
        </h2>
          
        <div id="editProfileTabsContainer">
          <ul class="editProfileTabLabelsContainer">
            <li><a href="#basic">#{locales['root.editProfile.basicTabLabel']}</a></li>
            <li><a href="#authSources">#{locales['root.editProfile.authSourcesTabLabel']}</a></li>
            <li><a href="#notifications">#{locales['root.editProfile.notificationsTabLabel']}</a></li>
            <li><a href="#chat">#{locales['root.editProfile.chatTabLabel']}</a></li>
          </ul>
          
          <div id="basic">
              
            <div class="formTitle">
              #{locales['root.editProfile.basicTitle']}
            </div>            
            
            <div id="editProfileBasic">
              
              <div class="editProfilePropertiesColumn">
                <ui:decorate template="/fragments/form.xhtml">
                  <ui:param name="id" value="basic-edit-profile" />
                  <ui:param name="output" value="HTML" />
      
                  <ui:define name="fields">
                    <ui:include src="/fragments/form_textfield.xhtml">
                      <ui:param name="output" value="HTML"/>
                      <ui:param name="id" value="firstName" />
                      <ui:param name="value" value="#{sessionController.loggedUser.firstName}"/>
                      <ui:param name="label" value="#{locales['root.editProfile.firstNameTitle']}" />
                      <ui:param name="classes" value="required" />
                    </ui:include>     

                    <ui:include src="/fragments/form_textfield.xhtml">
                      <ui:param name="output" value="HTML"/>
                      <ui:param name="id" value="lastName" />
                      <ui:param name="value" value="#{sessionController.loggedUser.lastName}"/>
                      <ui:param name="label" value="#{locales['root.editProfile.lastNameTitle']}" />
                      <ui:param name="classes" value="required" />
                    </ui:include>     
                    
                    <ui:include src="/fragments/form_textfield.xhtml">
                      <ui:param name="output" value="HTML"/>
                      <ui:param name="id" value="nickname" />
                      <ui:param name="value" value="#{sessionController.loggedUser.nickname}"/>
                      <ui:param name="label" value="#{locales['root.editProfile.nicknameTitle']}" />
                    </ui:include>  
                  </ui:define>
                  
                  <ui:define name="buttons">
                    
                    <ui:include src="/fragments/form_submitfield.xhtml">
                      <ui:param name="output" value="HTML"/>
                      <ui:param name="id" value="basic-edit-profile-save" />
                      <ui:param name="text" value="#{locales['root.editProfile.saveBasicLabel']}" />
                      <ui:param name="classes" value="formvalid" />
                    </ui:include> 

                  </ui:define>
                </ui:decorate>
              
                <!-- TODO: emails -->
              </div>
              
              <div class="editProfileImageColumn">
                <div class="editProfileImageContainer">
                  <div class="editProfileImageInnerContainer">
                    <img src="#{request.contextPath}/v1/users/SELF/profileImage/128x128" class="editProfileImage"/>
                  </div>
                </div>
                <a id="editProfileImageChangeLink" href="javascript:void(null)">#{locales['root.editProfile.changeProfileImageLink']}</a>
              </div>
            </div>
              
            <div class="editProfileMaterialQuota">
              <div class="formTitle">
                #{locales['root.editProfile.quotaTitle']}
              </div>                  

              <div class="editProfileMaterialQuotaUsed">
                <h:outputFormat value="#{locales['root.editProfile.quotaUsage']}">
                  <f:param value="#{editProfileViewBackingBean.materialsTotalSizeString}"/>
                  <f:param value="#{editProfileViewBackingBean.materialsQuotaSizeString}"/>
                  <f:param value="#{editProfileViewBackingBean.materialsQuotaPercentString}"/>
                </h:outputFormat>
             </div>
            </div>
          </div> 

          <div id="authSources">
            <div class="addAuthSourceContainer">
              <div class="addAuthSourceTitle formTitle">
                #{locales['root.editProfile.addNewAuthSourceTitle']}
              </div>
              <div class="addAuthSourceItemsContainer">
                <ui:repeat var="addebleAuthSource" value="#{editProfileViewBackingBean.addebleAuthSources}">
                  <ui:fragment rendered="#{addebleAuthSource eq 'INTERNAL'}">
                    <a class="addAuthSourceLink addAuthSourceLink_#{addebleAuthSource}" href="javascript:void(null);">#{locales['root.editProfile.authSourceInternalTitle']}</a>
                  </ui:fragment>

                  <ui:fragment rendered="#{addebleAuthSource eq 'GOOGLE'}">
                    <a class="addAuthSourceLink addAuthSourceLink_#{addebleAuthSource}" href="#{request.contextPath}/login?redirectUrl=#{request.contextPath}/editprofile.jsf&amp;loginMethod=#{addebleAuthSource}">#{locales['root.editProfile.authSourceGoogleTitle']}</a>
                  </ui:fragment>

                  <ui:fragment rendered="#{addebleAuthSource eq 'YAHOO'}">
                    <a class="addAuthSourceLink addAuthSourceLink_#{addebleAuthSource}" href="#{request.contextPath}/login?redirectUrl=#{request.contextPath}/editprofile.jsf&amp;loginMethod=#{addebleAuthSource}">#{locales['root.editProfile.authSourceYahooTitle']}</a>
                  </ui:fragment>

                  <ui:fragment rendered="#{addebleAuthSource eq 'FACEBOOK'}">
                    <a class="addAuthSourceLink addAuthSourceLink_#{addebleAuthSource}" href="#{request.contextPath}/login?redirectUrl=#{request.contextPath}/editprofile.jsf&amp;loginMethod=#{addebleAuthSource}">#{locales['root.editProfile.authSourceFacebookTitle']}</a>
                  </ui:fragment>
                
                </ui:repeat>
              </div>
            </div>
            <div class="enabledAuthSourcesTitle formTitle">
              #{locales['root.editProfile.enabledSourcesTitle']}
            </div>
            <div class="enabledAuthSourcesContainer">

              <ui:repeat var="identifierInfo" value="#{editProfileViewBackingBean.userIdentifierInfos}">
                <div class="enabledAuthSource #{identifierInfo.className}">
                  <div class="enabledAuthSourceInfo">
                    <div class="enabledAuthSourceName">#{identifierInfo.localizedName}</div>
                    <div class="enabledAuthSourceId">#{identifierInfo.identifier.sourceId}</div>
                  </div>

                  <ui:fragment rendered="#{!identifierInfo.verified}">
                    <div class="enabledAuthSourceNotVerified">#{locales['root.editProfile.authSourceNotVerified']}</div>
                  </ui:fragment>

                  <div class="enabledAuthSourceIcon"></div>
                  <div class="enabledAuthSourceActions">
                    <h:form>
                      <ui:fragment rendered="#{identifierInfo.supportsPasswordChange}">
                        <a class="enabledAuthSourceChangePasswordLink" href="javascript:void(null)">#{locales['root.editProfile.changePasswordLabel']}</a>
                      </ui:fragment>
                    </h:form>
                  </div>
                  
                  <ui:fragment rendered="#{identifierInfo.supportsPasswordChange}">
                    <div class="enabledAuthSourceChangePasswordFormContainer" style="display: none">
                      <ui:decorate template="/fragments/form.xhtml">
                        <ui:param name="id" value="auth-sources-change-password" />
                        <ui:param name="output" value="HTML" />
                        <ui:param name="autocomplete" value="off" />
            
                        <ui:define name="fields">
                          <ui:include src="/fragments/form_passwordfield.xhtml">
                            <ui:param name="output" value="HTML"/>
                            <ui:param name="id" value="oldPassword" />
                            <ui:param name="value" value="" />
                            <ui:param name="label" value="#{locales['root.editProfile.authSourceChangePasswordOldPasswordTitle']}" />
                            <ui:param name="classes" value="required" />
                          </ui:include>     
                          
                          <ui:include src="/fragments/form_passwordfield.xhtml">
                            <ui:param name="output" value="HTML"/>
                            <ui:param name="id" value="password1" />
                            <ui:param name="value" value="" />
                            <ui:param name="label" value="#{locales['root.editProfile.authSourceChangePasswordPassword1Title']}" />
                            <ui:param name="classes" value="required equals equals-password2" />
                          </ui:include>  
                          
                          <ui:include src="/fragments/form_passwordfield.xhtml">
                            <ui:param name="output" value="HTML"/>
                            <ui:param name="id" value="password2" />
                            <ui:param name="value" value="" />
                            <ui:param name="label" value="#{locales['root.editProfile.authSourceChangePasswordPassword2Title']}" />
                            <ui:param name="classes" value="required equals equals-password1" />
                          </ui:include>    
                        </ui:define>
                        
                        <ui:define name="buttons">
                          <ui:include src="/fragments/form_submitfield.xhtml">
                            <ui:param name="output" value="HTML"/>
                            <ui:param name="id" value="auth-sources-change-password-save-#{identifierInfo.identifier.id}"/>
                            <ui:param name="name" value="auth-sources-change-password-save" />
                            <ui:param name="text" value="#{locales['root.editProfile.authSourceChangePasswordLabel']}" />
                            <ui:param name="classes" value="formvalid" />
                          </ui:include> 
      
                        </ui:define>
                      </ui:decorate>
                      
                    </div>
                  </ui:fragment>
                </div> 

              </ui:repeat>
            </div>
            
            <div class="newAuthSourceInternal" style="display: none">
              <div class="newAuthSourceInfo">
                <div class="newAuthSourceName formTitle">#{locales['root.editProfile.authSourceInternalTitle']}</div>
              </div>
              <div class="newAuthSourceIcon"></div>
              <div class="newAuthSourcePasswordFormContainer">
                <ui:decorate template="/fragments/form.xhtml">
                  <ui:param name="id" value="auth-sources-new-internal-auth" />
                  <ui:param name="output" value="HTML" />
                  <ui:param name="autocomplete" value="off" />
        
                    <ui:define name="fields">
                      <ui:include src="/fragments/form_passwordfield.xhtml">
                        <ui:param name="output" value="HTML"/>
                        <ui:param name="id" value="password1" />
                        <ui:param name="value" value="" />
                        <ui:param name="label" value="#{locales['root.editProfile.newInternalAuthSourcePasswordPassword1Title']}" />
                        <ui:param name="classes" value="required equals equals-password2" />
                      </ui:include>  
                      
                      <ui:include src="/fragments/form_passwordfield.xhtml">
                        <ui:param name="output" value="HTML"/>
                        <ui:param name="id" value="password2" />
                        <ui:param name="value" value="" />
                        <ui:param name="label" value="#{locales['root.editProfile.newInternalAuthSourcePasswordPassword2Title']}" />
                        <ui:param name="classes" value="required equals equals-password1" />
                      </ui:include>    
                    </ui:define>
                    
                    <ui:define name="buttons">
                      <ui:include src="/fragments/form_submitfield.xhtml">
                        <ui:param name="output" value="HTML"/>
                        <ui:param name="id" value="auth-sources-new-internal-auth-save"/>
                        <ui:param name="text" value="#{locales['root.editProfile.newInternalAuthSourceCreateLabel']}" />
                        <ui:param name="classes" value="formvalid" />
                      </ui:include> 
                    </ui:define>
                    
                </ui:decorate>
              </div>
            </div>
          </div>  
          
          <div id="notifications">
            <div class="notificationsTitle formTitle">
              #{locales['root.editProfile.notificationsTitle']}
            </div>
            <div class="notificationSettingsContainer">
              <ui:decorate template="/fragments/form.xhtml">
                <ui:param name="id" value="notification-settings" />
                <ui:param name="output" value="HTML" />
    
                <ui:define name="fields">

                  <div class="notificationSettingContainer">
                    <ui:fragment rendered="#{editProfileViewBackingBean.friendRequestNotify}">
                      <input type="checkbox" id="notificationSettingFriendRequest" name="RemovedFromFriends" value="1" checked="checked"/>
                    </ui:fragment>
  
                    <ui:fragment rendered="#{!editProfileViewBackingBean.friendRequestNotify}">
                      <input type="checkbox" id="notificationSettingFriendRequest" name="RemovedFromFriends" value="1" />
                    </ui:fragment>
  
                    <label for="notificationSettingFriendRequestAccepted">
                      #{locales['root.editProfile.notificationsFriendRequest']}
                    </label>
                  </div>

                  <div class="notificationSettingContainer">
                    <ui:fragment rendered="#{editProfileViewBackingBean.friendRequestAcceptedNotify}">
                      <input type="checkbox" id="notificationSettingFriendRequestAccepted" name="RemovedFromFriends" value="1" checked="checked"/>
                    </ui:fragment>
  
                    <ui:fragment rendered="#{!editProfileViewBackingBean.friendRequestAcceptedNotify}">
                      <input type="checkbox" id="notificationSettingFriendRequestAccepted" name="RemovedFromFriends" value="1" />
                    </ui:fragment>
  
                    <label for="notificationSettingFriendRequestAccepted">
                      #{locales['root.editProfile.notificationsFriendRequestAccepted']}
                    </label>
                  </div>

                  <div class="notificationSettingContainer">
                    <ui:fragment rendered="#{editProfileViewBackingBean.removedFromFriendsNotify}">
                      <input type="checkbox" id="notificationSettingRemovedFromFriends" name="RemovedFromFriends" value="1" checked="checked"/>
                    </ui:fragment>
  
                    <ui:fragment rendered="#{!editProfileViewBackingBean.removedFromFriendsNotify}">
                      <input type="checkbox" id="notificationSettingRemovedFromFriends" name="RemovedFromFriends" value="1" />
                    </ui:fragment>
  
                    <label for="notificationSettingRemovedFromFriends">
                      #{locales['root.editProfile.notificationsRemovedFromFriends']}
                    </label>
                  </div>
                  
                  <div class="notificationSettingContainer">
                    <ui:fragment rendered="#{editProfileViewBackingBean.materialSharedNotify}">
                      <input type="checkbox" id="notificationSettingMaterialShared" name="RemovedFromFriends" value="1" checked="checked"/>
                    </ui:fragment>
  
                    <ui:fragment rendered="#{!editProfileViewBackingBean.materialSharedNotify}">
                      <input type="checkbox" id="notificationSettingMaterialShared" name="RemovedFromFriends" value="1" />
                    </ui:fragment>
  
                    <label for="notificationSettingMaterialShared">
                      #{locales['root.editProfile.notificationsMaterialShared']}
                    </label>
                  </div>
                  
                  <div class="notificationSettingContainer">
                    <ui:fragment rendered="#{editProfileViewBackingBean.privateMessageReceivedNotify}">
                      <input type="checkbox" id="notificationSettingPrivateMessageReceived" name="RemovedFromFriends" value="1" checked="checked"/>
                    </ui:fragment>
  
                    <ui:fragment rendered="#{!editProfileViewBackingBean.privateMessageReceivedNotify}">
                      <input type="checkbox" id="notificationSettingPrivateMessageReceived" name="RemovedFromFriends" value="1" />
                    </ui:fragment>
  
                    <label for="notificationSettingPrivateMessageReceived">
                      #{locales['root.editProfile.notificationsPrivateMessageReceived']}
                    </label>
                  </div>
                </ui:define>
                
                <ui:define name="buttons">
                  <ui:include src="/fragments/form_submitfield.xhtml">
                    <ui:param name="output" value="HTML"/>
                    <ui:param name="id" value="notification-settings-save"/>
                    <ui:param name="text" value="#{locales['root.editProfile.saveNotificationsLabel']}" />
                    <ui:param name="classes" value="formvalid" />
                  </ui:include> 
                </ui:define>
              </ui:decorate>
            </div>
          </div>

          <div id="chat">
            <div class="formTitle">
              #{locales['root.editProfile.chatSettingsTitle']}
            </div>
          
            <div class="chatSettingsContainer">
              <ui:decorate template="/fragments/form.xhtml">
                <ui:param name="id" value="chat-settings" />
                <ui:param name="output" value="HTML" />
      
                  <ui:define name="fields">
                    <ui:include src="/fragments/form_textfield.xhtml">
                      <ui:param name="id" value="chatServerUrl" />
                      <ui:param name="disabled" value="true" />
                      <ui:param name="label" value="#{locales['root.editProfile.chatServerTitle']}" />
                      <ui:param name="value" value="#{editProfileViewBackingBean.chatServerUrl}"/>
                    </ui:include>  
                    
                    <ui:include src="/fragments/form_textfield.xhtml">
                      <ui:param name="id" value="chatUserJid" />
                      <ui:param name="disabled" value="true" />
                      <ui:param name="label" value="#{locales['root.editProfile.chatUserJidTitle']}" />
                      <ui:param name="value" value="#{editProfileViewBackingBean.chatCredentialsUserJid}"/>
                    </ui:include>  
                    
                    <ui:include src="/fragments/form_textfield.xhtml">
                      <ui:param name="id" value="chatPassword" />
                      <ui:param name="disabled" value="true" />
                      <ui:param name="label" value="#{locales['root.editProfile.chatPasswordTitle']}" />
                      <ui:param name="value" value="#{editProfileViewBackingBean.chatCredentialsPassword}"/>
                    </ui:include>  
                  </ui:define>
                  
                  <ui:define name="buttons">
                    <ui:include src="/fragments/form_submitfield.xhtml">
                      <ui:param name="id" value="chat-settings-save"/>
                      <ui:param name="disabled" value="true" />
                      <ui:param name="text" value="#{locales['root.editProfile.saveChatLabel']}" />
                      <ui:param name="classes" value="formvalid" />
                    </ui:include> 
                  </ui:define>
                  
                </ui:decorate>
            </div>
          </div>  

        </div> 
      </div>
    </ui:define>

</ui:composition>
