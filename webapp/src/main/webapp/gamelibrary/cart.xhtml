<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html" template="/WEB-INF/templates/gamelibrary.xhtml">

  <ui:define name="pageTitle">#{locales['gamelibrary.cart.pageTitle']}</ui:define>
  <ui:define name="head">
  
    <!-- View specific -->
    
    <link rel="StyleSheet" type="text/css" href="#{request.contextPath}/themes/novus/css/gamelibrary.css"/>
  
  </ui:define>
  <ui:define name="content">
    <h:panelGroup layout="block" id="gamelibrary-cart">
      <h3 class="gamelibrary-cart-title">
        <span>Shopping Cart</span>
        <h:link outcome="/gamelibrary/index.jsf" value="Back to Store"/>
      </h3>
      <div class="gamelibrary-cart-contents">
        <h:form id="gamelibrary-cart-form">
          <h:panelGroup layout="block" id="gamelibrary-cart-items-container"> 
            <h4>Items</h4>
            
            <div class="gamelibrary-cart-items-inner-container">
             <!-- TODO: Cart empty message -->
             
             <div class="gamelibrary-cart-item-header-container"> 
               <div class="gamelibrary-cart-cell-header gamelibrary-cart-item-actions"></div>     
               <div class="gamelibrary-cart-cell-header gamelibrary-cart-item-count">Count</div>  
               <div class="gamelibrary-cart-cell-header gamelibrary-cart-item-name">Item</div>   
               <div class="gamelibrary-cart-cell-header gamelibrary-cart-item-price">Unit Price</div>
               <div class="gamelibrary-cart-cell-header gamelibrary-cart-item-total-price">Total Price</div> 
             </div>
             
             <ui:repeat var="cartItem" value="#{shoppingCartBackingBean.shoppingCartItems}">  
               <div class="gamelibrary-cart-item-container">  
                  <div class="gamelibrary-cart-cell gamelibrary-cart-item-actions">
                    <h:commandButton action="#{shoppingCartBackingBean.incShoppingCartItemCount(cartItem.id)}" value="+">
                      <f:ajax render=":gamelibrary-cart" execute="@form"/>
                    </h:commandButton>
                    <h:commandButton action="#{shoppingCartBackingBean.decShoppingCartItemCount(cartItem.id)}" value="-">
                      <f:ajax render=":gamelibrary-cart" execute="@form"/>
                    </h:commandButton>
                  </div>
                  <div class="gamelibrary-cart-cell gamelibrary-cart-item-count">#{cartItem.count}</div>
                  <div class="gamelibrary-cart-cell gamelibrary-cart-item-name">#{cartItem.name}</div>  
                  <div class="gamelibrary-cart-cell gamelibrary-cart-item-price">
                    <h:outputText value="#{cartItem.price}" >
                      <f:convertNumber currencyCode="EUR" type="currency" />
                    </h:outputText>
                  </div>
                  <div class="gamelibrary-cart-cell gamelibrary-cart-item-total-price">
                    <h:outputText value="#{cartItem.totalPrice}" >
                      <f:convertNumber currencyCode="EUR" type="currency" />
                    </h:outputText>
                  </div> 
                </div>
              </ui:repeat>
            </div>
          </h:panelGroup>
          
          <!-- TODO: If items need delivering -->
          
          <div id="gamelibrary-cart-delivery-container">
            <h4>Shipping</h4>
            
            <ui:repeat var="deliveryMethod" value="#{shoppingCartBackingBean.deliveryMethods}">
              <div class="gamelibrary-cart-delivery-method-container">
                <h:selectOneRadio value="#{shoppingCartBackingBean.deliveryMethodId}">
                  <f:selectItem itemLabel="#{deliveryMethod.name}" itemValue="#{deliveryMethod.id}"/>
                  <f:ajax render=":gamelibrary-cart" />
                </h:selectOneRadio>
                
                <div class="gamelibrary-cart-delivery-method-price">
                  <ui:fragment rendered="#{deliveryMethod.requiresAddress}">
                    <span class="gamelibrary-cart-delivery-method-price-note" title="Delivery country can affect shipping costs">*</span>
                  </ui:fragment>
                  <span>
                    <h:outputText value="#{deliveryMethod.price}">
                      <f:convertNumber currencyCode="EUR" type="currency" />
                    </h:outputText>
                  </span>
                </div> 
                  
                <div class="gamelibrary-cart-delivery-method-info">#{deliveryMethod.info}</div> 
                <div class="gamelibrary-cart-delivery-method-details">
                  <ui:fragment rendered="#{deliveryMethod.requiresAddress}">
                    <h:panelGroup layout="block">
                      <div class="gamelibrary-cart-delivery-address-container">
                        <h:selectOneRadio styleClass="gamelibrary-cart-delivery-address-radio" value="#{shoppingCartBackingBean.addressId}">
                          <f:selectItems value="#{shoppingCartBackingBean.addressSelectItems}"/>
                        </h:selectOneRadio>
                        
                        <div class="gamelibrary-cart-delivery-address-new-container">
                          <div class="gamelibrary-cart-delivery-address-new-address">
                            <div class="gamelibrary-cart-delivery-address-field">
                              <div class="gamelibrary-cart-delivery-address-field-label">
                                <h:outputLabel value="Name" />
                              </div>
                              <div class="gamelibrary-cart-delivery-address-field-input">
                                <h:inputText value="#{shoppingCartBackingBean.addressPersonName}" />
                              </div>
                            </div>
                            
                            <div class="gamelibrary-cart-delivery-address-field">
                              <div class="gamelibrary-cart-delivery-address-field-label">
                                <h:outputLabel value="Company" />
                              </div>
                              <div class="gamelibrary-cart-delivery-address-field-input">
                                <h:inputText value="#{shoppingCartBackingBean.addressCompanyName}" />
                              </div>
                            </div>
                            
                            <div class="gamelibrary-cart-delivery-address-field">
                              <div class="gamelibrary-cart-delivery-address-field-label">
                                <h:outputLabel value="Street 1" />
                              </div>
                              <div class="gamelibrary-cart-delivery-address-field-input">
                                <h:inputText value="#{shoppingCartBackingBean.addressStreet1}" />
                              </div>
                            </div>
                            
                            <div class="gamelibrary-cart-delivery-address-field">
                              <div class="gamelibrary-cart-delivery-address-field-label">
                                <h:outputLabel value="Street 2" />
                              </div>
                              <div class="gamelibrary-cart-delivery-address-field-input">
                                <h:inputText value="#{shoppingCartBackingBean.addressStreet2}" />
                              </div>
                            </div>
                            
                            <div class="gamelibrary-cart-delivery-address-field">
                              <div class="gamelibrary-cart-delivery-address-field-label">
                                <h:outputLabel value="Postal Code / Zip" />
                              </div>
                              <div class="gamelibrary-cart-delivery-address-field-input">
                                <h:inputText value="#{shoppingCartBackingBean.addressPostalCode}" />
                              </div>
                            </div>
                            
                            <div class="gamelibrary-cart-delivery-address-field">
                              <div class="gamelibrary-cart-delivery-address-field-label">
                                <h:outputLabel value="City" />
                              </div>
                              <div class="gamelibrary-cart-delivery-address-field-input">
                                <h:inputText value="#{shoppingCartBackingBean.addressCity}" />
                              </div>
                            </div>
                            
                            <div class="gamelibrary-cart-delivery-address-field">
                              <div class="gamelibrary-cart-delivery-address-field-label">
                                <h:outputLabel value="Country" />
                              </div>
                              <div class="gamelibrary-cart-delivery-address-field-input">
                                <h:selectOneMenu id="address-country-id" value="#{shoppingCartBackingBean.addressCountryId}">
                                  <f:selectItems value="#{shoppingCartBackingBean.countrySelectItems}"/>
                                  <f:ajax render=":gamelibrary-cart"/>
                                </h:selectOneMenu>
                              </div>
                            </div>
                          </div>
                        </div>

                      </div>
                    </h:panelGroup>
                  </ui:fragment>
                </div>
                
              </div>
            </ui:repeat>
            
            <div class="gamelibrary-cart-delivery-method-price-note-text">* Delivery country can affect shipping costs</div>
          </div>          
          
          <div id="gamelibrary-cart-summary-container">
            <h4>Summary</h4>
            <div id="gamelibrary-cart-summary-items" class="gamelibrary-cart-summary-item">
              <h5>Items</h5>
              <span>
                <h:outputText value="#{shoppingCartBackingBean.itemCosts}" >
                  <f:convertNumber currencyCode="EUR" type="currency" />
                </h:outputText>
              </span>
            </div>
            <div id="gamelibrary-cart-summary-delivery" class="gamelibrary-cart-summary-item">
              <h5>Delivery</h5>
              <span>
                <h:outputText value="#{shoppingCartBackingBean.deliveryCosts}" >
                  <f:convertNumber currencyCode="EUR" type="currency" />
                </h:outputText>
              </span>
            </div>
            <div id="gamelibrary-cart-summary-tax" class="gamelibrary-cart-summary-item">
              <h5>Tax (VAT 23 %)</h5>
              <span>
                <h:outputText value="#{shoppingCartBackingBean.taxAmount}" >
                  <f:convertNumber currencyCode="EUR" type="currency" />
                </h:outputText>
              </span>
            </div>
            <div id="gamelibrary-cart-summary-total-price" class="gamelibrary-cart-summary-item">
              <h5>Total</h5>
              <span>
                <h:outputText value="#{shoppingCartBackingBean.netPrice}" >
                  <f:convertNumber currencyCode="EUR" type="currency" />
                </h:outputText>
              </span>
            </div>
          </div>
          
          <h:commandButton value="Proceed to Checkout" action="#{shoppingCartBackingBean.proceedToCheckout}" />
          
        </h:form>
      </div>  
    </h:panelGroup>
  </ui:define>

</ui:composition>