<?xml version="1.0" encoding="UTF-8"?>
<ui:composition 
  xmlns="http://www.w3.org/1999/xhtml" 
  xmlns:ui="http://java.sun.com/jsf/facelets" 
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html" 
  template="/WEB-INF/templates/gamelibrary_publications.xhtml">

  <ui:define name="products">
    <h:form>
      <h:panelGroup layout="block" id="gamelibrary-index" styleClass="gamelibrary-index">
        <div class="gamelibrary-products">
          <h3 class="gamelibrary-products-title">
            <span class="gamelibrary-nav-item">
              <h:outputLink value="#{request.contextPath}/gamelibrary/">
                #{locales['gamelibrary.tagList.navIndex']} 
              </h:outputLink>
            </span>
            <span class="gamelibrary-nav-separator"/>
            <span class="gamelibrary-nav-item">#{productTagListBackingBean.tag}</span>
          </h3>
          
          <div class="gamelibrary-products">
            <ui:repeat var="product" value="#{productTagListBackingBean.products}">
              <div data-product-id="#{product.id}" class="gamelibrary-product">
                <div class="gamelibrary-product-info-container">
                  <div class="gamelibrary-product-name">
                    <h:outputLink value="#{request.contextPath}/gamelibrary/#{product.urlName}">#{product.name}</h:outputLink>
                  </div>
                  <div class="gamelibrary-product-tags-container">
                    <ui:repeat var="tag" value="#{productTagListBackingBean.getTags(product)}">
                      <div class="gamelibrary-product-tag">
                        <h:outputLink value="#{request.contextPath}/gamelibrary/tags/#{tag.text}">#{tag.text}</h:outputLink>
                      </div>
                    </ui:repeat>
                  </div>
                  
                  <div class="gamelibrary-product-description">#{product.description}</div>
                  <div class="gamelibrary-product-details">
                    <div class="gamelibrary-product-detail">
                      <span>#{locales['gamelibrary.tagList.publicationDetailsPrice']}</span>
                      <span class="gamelibrary-product-details-price">
                        <h:outputText value="#{product.price}" >
                          <f:convertNumber currencyCode="EUR" type="currency" />
                        </h:outputText>
                      </span>
                    </div>
                    
                    <ui:fragment rendered="#{productTagListBackingBean.getBookProduct(product) ne null}">
                      <ui:fragment rendered="#{productTagListBackingBean.getBookProduct(product).numberOfPages > 0}">
                        <div class="gamelibrary-product-detail">
                          <span>#{locales['gamelibrary.tagList.publicationDetailsNumberOfPages']}</span> 
                          <span>#{productTagListBackingBean.getBookProduct(product).numberOfPages}</span>
                        </div>
                      </ui:fragment>

                      <ui:fragment rendered="#{!empty(productTagListBackingBean.getBookProduct(product).author)}">
                        <span>#{locales['gamelibrary.tagList.publicationDetailsAuthor']}</span> 
                        <span>#{productTagListBackingBean.getBookProduct(product).author}</span>
                      </ui:fragment>
                    </ui:fragment>
                    
                    <h:panelGroup layout="block" rendered="#{product.forumTopic ne null}" styleClass="gamelibrary-product-comments">
                      <h:outputLink value="#{request.contextPath}/forum/#{product.forumTopic.forum.urlName}/#{product.forumTopic.urlName}">
                        <h:outputFormat value="#{locales['gamelibrary.tagList.publicationComments']}">
                          <f:param value="#{productTagListBackingBean.getProductCommentCount(product)}"/>
                        </h:outputFormat>                    
                      </h:outputLink>
                    </h:panelGroup>
                  </div>
                  
                  <ui:fragment rendered="#{product.published}">
                    <!-- TODO: Admins and owners only -->
                    <div class="gamelibrary-product-admin-actions-container">
                      <div class="gamelibrary-product-admin-action-container">
                        <a title="Unpublish Product" href="javascript:void(null);" data-product-id="#{product.id}" data-product-name="#{product.name}" class="product-unpublish"></a>
                      </div>
                    </div>
                  </ui:fragment>
                  
                  <ui:fragment rendered="#{!product.published}">
                    <div class="gamelibrary-product-admin-actions-container">
                      <div class="gamelibrary-product-admin-action-container">
                        <a class="product-publish" data-product-id="#{product.id}" data-product-name="#{product.name}" href="javascript:void(null);" title="Publish Product"></a>
                      </div>
                      <div class="gamelibrary-product-admin-action-container">
                        <a class="product-edit" data-product-id="#{product.id}" href="javascript:void(null);" title="Edit"></a>
                      </div>
                      <div class="gamelibrary-product-admin-action-container">
                        <a class="product-add-images-action" data-product-id="#{product.id}" href="javascript:void(null);" title="Add Images"></a>
                      </div>
                      <div class="gamelibrary-product-admin-action-container">
                        <a class="product-delete" data-product-id="#{product.id}" data-product-name="#{product.name}" href="javascript:void(null);" title="Delete Product"></a>
                      </div>
                    </div>
                  </ui:fragment>
                  
                </div>
                
                <div class="gamelibrary-product-images-container">
                  <ui:fragment rendered="#{productTagListBackingBean.hasSeveralImages(product)}">
                    <div class="gamelibrary-product-thumbnails-container">
                      <div class="gamelibrary-product-thumbnails-inner-container">
                        <ui:repeat value="#{productTagListBackingBean.getProductImages(product)}" var="productImage">
                          <div class="gamelibrary-product-thumbnail-container">
                            <a href="javascript:void(null)">
                              <img data-url="#{request.contextPath}/gamelibrary/publicationImages/#{productImage.id}" src="#{request.contextPath}/gamelibrary/publicationImages/#{productImage.id}?width=32&amp;height=32"/>
                            </a>
                          </div>
                        </ui:repeat>
                      </div>
                    </div>
                  </ui:fragment>
  
                  <ui:fragment rendered="#{productTagListBackingBean.hasImages(product)}">
                    <div class="gamelibrary-product-image-container">
                      <div class="gamelibrary-product-image-inner-container">
                        <a href="#{request.contextPath}/gamelibrary/publicationImages/#{productTagListBackingBean.getFirstImage(product).id}">
                          <img data-url="#{request.contextPath}/gamelibrary/publicationImages/#{productTagListBackingBean.getFirstImage(product).id}" src="#{request.contextPath}/gamelibrary/publicationImages/#{productTagListBackingBean.getFirstImage(product).id}?width=128&amp;height=128"/>
                        </a>
                      </div>
                    </div>
                  </ui:fragment>
                </div>
                
                <div class="gamelibrary-product-actions-container">
                  <div class="gamelibrary-product-action-container">
                    <a href="#{request.contextPath}/gamelibrary/publicationFiles/#{product.id}">#{locales['gamelibrary.tagList.publicationDownloadFreePdf']}</a>
                  </div>
                  <div class="gamelibrary-product-action-container">
                    <h:commandLink action="#{productTagListBackingBean.addProductToShoppingCart(product)}" value="#{locales['gamelibrary.tagList.publicationAddToShoppingCart']}" styleClass="gamelibrary-product-add-to-cart-action">
                    </h:commandLink>
                  </div>
                </div>
                
                <div class="clearFloating"></div>
              </div>
            </ui:repeat>
          </div>
        </div>
      </h:panelGroup>
    </h:form>
  </ui:define>  
</ui:composition>
    
    